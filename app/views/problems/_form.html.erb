<script id="task-template" type="x-tmpl-mustache">
<%
# This chunk is actually copied and modified from the HTML generated by fields_for.
# Any suggestions to DRY up this part?
%>
<div class="task-{{ task_count }}">
  <button type="button" class="close" data-target=".task-{{task_count}}" data-dismiss="task-form">
    <span aria-hidden="true">&times;</span>
    <span class="sr-only">Close</span>
  </button>

  <div class="form-group">
    <label for="problem_tasks_attributes_{{ task_count }}_point">Point</label>
    <input class="form-control" id="problem_tasks_attributes_{{ task_count }}_point" name="problem[tasks_attributes][{{ task_count }}][point]" required="required" type="number" value="0" />
  </div>

  <div class="form-group">
    <label for="problem_tasks_attributes_{{ task_count }}_tokens">Tokens</label>
    <input class="form-control" id="problem_tasks_attributes_{{ task_count }}_tokens" name="problem[tasks_attributes][{{ task_count }}][tokens]" required="required" type="number" value="0" />
  </div>

  <div class="form-group">
    <label for="problem_tasks_attributes_{{ task_count }}_input">Input</label>
    <textarea class="form-control" id="problem_tasks_attributes_{{ task_count }}_input" name="problem[tasks_attributes][{{ task_count }}][input]"></textarea>
  </div>

  <div class="form-group">
    <label for="problem_tasks_attributes_{{ task_count }}_output">Output</label>
    <textarea class="form-control" id="problem_tasks_attributes_{{ task_count }}_output" name="problem[tasks_attributes][{{ task_count }}][output]"></textarea>
  </div>
</div>
</script>

<% if @problem.errors.any? %>
  <% @problem.errors.full_messages.each do |message| %>
   <div class="alert alert-danger" role="alert"><%= message %></div>
  <% end %>
<% end %>

<%= form_for(@problem) do |f| %>
  <div class="form-group">
    <%= f.label :title %>
    <%= f.text_field :title, :class => "form-control", :required => true %>
  </div>

  <div class="form-group">
    <%= f.label :statement %>
    <span class="help-block">You may use <a href="http://kramdown.gettalong.org/syntax.html">Markdown</a> to format the statement.</span>
    <%= f.text_area :statement, :class => "form-control", :required => true %>
  </div>

  <div class="form-group">
    <%= f.fields_for(:permalink, @problem.permalink || Permalink.new) do |ff| %>
      <%= ff.label :url, "Permalink" %>
      <%= ff.text_field :url, :class => "form-control permalink-field" %>
      <%= ff.hidden_field :_destroy %>
    <% end %>
  </div>

  <div class="checkbox">
    <label>
      <%= f.check_box :contest_only %> Contest-only
    </label>
  </div>

  <div class="tasks-forms">
    <%= f.fields_for :tasks, :include_id => false do |ff| %>
      <div class="task-<%= ff.index %>">
        <%= ff.hidden_field :id %>

        <div class="form-group">
          <%= ff.label :point %>
          <%= ff.number_field :point, :class => "form-control", :required => true %>
        </div>

        <div class="form-group">
          <%= ff.label :tokens %>
          <%= ff.number_field :tokens, :class => "form-control", :required => true %>
        </div>

        <div class="form-group">
          <%= ff.label :input %>
          <%= ff.text_area :input, :class => "form-control" %>
        </div>

        <div class="form-group">
          <%= ff.label :output %>
          <%= ff.text_area :output, :class => "form-control" %>
        </div>

        <div class="checkbox">
          <label>
            <%= ff.check_box :_destroy %>
            Delete
          </label>
        </div>
      </div>
    <% end %>
  </div>

  <%= f.button "Add Task", :class => "btn btn-default", :id => "add-task-btn" %>

  <% if @problem.id %>
    <%= f.submit "Update", :class => "btn btn-primary" %>
  <% else %>
    <%= f.submit "Create", :class => "btn btn-primary" %>
  <% end %>
<% end %>
