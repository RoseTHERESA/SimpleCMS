<%= form_for(@problem, :html => { "ng-app" => "ProblemFormApp", "ng-controller" => "ProblemFormController", "problem-id" => @problem.id, "ng-submit" => "saveProblem($event)", "authenticity-token" => form_authenticity_token }) do |f| %>
  <div class="alert alert-danger" role="alert" ng-repeat="message in problem.errors">
    {{ message }}
  </div>

  <div class="form-group">
    <%= f.label :title %>
    <%= f.text_field :title, :class => "form-control", :required => true, "ng-model" => "problem.title" %>
  </div>

  <div class="form-group">
    <%= f.label :statement %>
    <span class="help-block">You may use <a href="http://kramdown.gettalong.org/syntax.html">Markdown</a> to format the statement.</span>
    <%= f.text_area :statement, :class => "form-control", :required => true, "ng-model" => "problem.statement" %>
  </div>

  <div class="form-group">
    <%= f.fields_for(:permalink, @problem.permalink || Permalink.new) do |ff| %>
      <%= ff.label :url, "Permalink" %>
      <%= ff.text_field :url, :class => "form-control permalink-field", "ng-model" => "problem.permalink_attributes.url" %>
      <%= ff.hidden_field :_destroy, "ng-model" => "problem.permalink_attributes._destroy" %>
    <% end %>
  </div>

  <div class="checkbox">
    <label>
      <%= f.check_box :contest_only, "ng-model" => "problem.contest_only" %> Contest-only
    </label>
  </div>

  <div ui-sortable ng-model="problem.tasks_attributes" class="tasks-forms">
    <div ng-repeat="task in problem.tasks_attributes">
      <hr>

      <button type="button" class="close" ng-show="task.id===undefined || task.id===null" ng-click="removeTask($index)">
        <span aria-hidden="true">&times;</span>
        <span class="sr-only">Close</span>
      </button>

      <input type="hidden" ng-model="task.id">

      <div class="form-group">
        <label>Point</label>
        <input type="number" class="form-control" ng-model="task.point">
      </div>

      <div class="form-group">
        <label>Tokens</label>
        <input type="number" class="form-control" ng-model="task.tokens">
      </div>

      <div class="form-group">
        <label>Input</label>

        <div ng-hide="task.json">
          <textarea class="form-control" ng-model="task.input"></textarea>
        </div>

        <div ui-sortable ng-model="task.input_fields" ng-show="task.json">
          <div ng-repeat="field in task.input_fields">
            <div class="form-group">
              <label>Label</label>
              <input type="text" class="form-control" ng-model="field.label">
            </div>

            <div class="form-group">
              <label>Content</label>
              <textarea class="form-control" ng-model="field.content"></textarea>
            </div>
          </div>
          <button type="button" class="btn btn-default" ng-click="taskAddInputField($index)">Add Field</button>
        </div>
      </div>

      <div class="form-group">
        <label>Output</label>
        <textarea class="form-control" ng-model="task.output"></textarea>
      </div>

      <div class="checkbox" ng-show="task.id!==undefined && task.id!==null">
        <label>
          <input type="checkbox" ng-model="task._destroy"> Delete
        </label>
      </div>

      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="task.json"> Multifields Input
        </label>
      </div>
    </div>
  </div>

  <%= f.button "Add Task", :class => "btn btn-default", :id => "add-task-btn", :type => "button", "ng-click" => "addTask()" %>

  <% if @problem.id %>
    <%= f.submit "Update", :class => "btn btn-primary" %>
  <% else %>
    <%= f.submit "Create", :class => "btn btn-primary" %>
  <% end %>
<% end %>
