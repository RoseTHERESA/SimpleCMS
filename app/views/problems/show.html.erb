<div ng-app="ProblemPage" ng-controller="ProblemPage" problem-id="<%= @problem.id %>">
  <div class="header-container">
    <span class="h1">
      <%= @problem.title %>

      <% if @problem.solvers.include?(current_user) %>
        <small><span class="text-success">(Solved)</span></small>
      <% end %>

      <% if @problem.attempted_by?(current_user) %>
        <small>
          <%= render :partial => "point", :locals => { :problem => @problem, :user => current_user } %>
        </small>
      <% end %>

      <% if signed_in? && current_user.admin? %>
        <%= link_to icon("edit"), edit_problem_path(@problem), :class => "btn btn-default pull-right", :title => "Edit" %>
      <% end %>
    </span>
  </div>

  <div class="panel panel-default">
    <div class="panel-body" data-mathjax-source>
      <%= Kramdown::Document.new(@problem.statement).to_html.html_safe %>
    </div>
  </div>

  <% if signed_in? %>
    <div class="form-group">
      <label>Python Code</label>
      <div>
        <button type="button" class="btn btn-default" ng-click="runCode()">Run</button>
        <button type="button" class="btn btn-default" ng-click="runCodeWithTestCases()">Run with Test Cases</button>
      </div>

      <div ui-ace="{mode: 'python', theme: 'monokai'}" ng-model="code" style="height:200px; margin-top: 10px"></div>
      <ul class="list-unstyled">
        <li ng-repeat="log in logs track by $index" ng-class="{ 'text-success': log.type == 'result', 'text-danger': log.type == 'stderr', 'text-warning': log.type == 'system' }">
          <pre class="repl-log"><span ng-show="log.type == 'result'">=> </span>{{ log.message }}</pre>
        </li>
      </ul>
    </div>

    <hr>

    <div class="well" ng-repeat="task in problem.tasks_attributes">
      <div ng-hide="task.json && task.input_fields">
        <pre >{{ task.input }}</pre>
        <button type="button" class="btn btn-default" zero-clipboard="task.input">Copy</button>
      </div>

      <div ng-show="task.json && task.input_fields">
        <div class="form-group input-group" ng-repeat="field in task.input_fields">
          <span class="input-group-addon">{{ field.label }}</span>

          <input type="text" class="form-control task-input" readonly ng-value="field.content" ng-if="field.content.trim().indexOf('\n') == -1">

          <textarea class="form-control task-input" readonly ng-if="field.content.trim().indexOf('\n') != -1">{{ field.content }}</textarea>

          <span class="input-group-btn">
            <button class="btn btn-default" type="button" zero-clipboard="field.content">Copy</button>
          </span>
        </div>
      </div>

      <form action="<%= submissions_path %>" method="post">
        <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
        <input type="hidden" name="submission[task_id]" ng-value="task.id">
        <input type="hidden" name="submission[code]" ng-value="task.submission.code">

        <div class="form-group">
          <label>Answer</label>
          <textarea class="form-control" ng-model="task.submission.input" name="submission[input]"></textarea>
        </div>

        <p class="help-block" ng-show="isNumber(task.submissions_left)">
          You have {{ task.submissions_left }} submissions left.
        </p>

        <input type="submit" class="btn btn-default" ng-class="{disabled: !task.submission_allowed}">

        <span class="label label-success" ng-show="task.solved">Solved!</span>
        <span class="label label-danger" ng-show="!task.solved && task.attempted">Wrong answer</span>
      </form>
    </div>
  <% else %>
    <p>Please sign in to solve this task.</p>
  <% end %>
</div>
