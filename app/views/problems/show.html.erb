<div ng-app="ProblemPage" ng-controller="ProblemPage" problem-id="<%= @problem.id %>">
  <div class="header-container">
    <span class="h1">
      <%= @problem.title %>

      <small ng-show="problem.solved">
        <span class="text-success">(Solved)</span>
      </small>

      <small ng-show="problem.attempted">
        ({{ problem.current_points }}/{{ problem.total_points }})
      </small>

      <% if signed_in? && current_user.admin? %>
        <%= link_to icon("edit"), edit_problem_path(@problem), :class => "btn btn-default pull-right", :title => "Edit" %>
      <% end %>
    </span>
  </div>

  <div class="panel panel-default">
    <div class="panel-body" data-mathjax-source>
      <%= Kramdown::Document.new(@problem.statement).to_html.html_safe %>
    </div>
  </div>

  <% if signed_in? %>
    <%
      user_submissions = @problem.last_submissions_by(current_user)
      last_submission_with_code = user_submissions.values.select do |x|
        x && !x.code.empty?
      end.max_by { |x| x.created_at} || Submission.new
    %>

    <div class="form-group">
      <label>Python Code</label>
      <div>
        <button type="button" class="btn btn-default" ng-click="runCode()">Run</button>
        <button type="button" class="btn btn-default" ng-click="runCodeWithTestCases()">Run with Test Cases</button>
      </div>

      <div ui-ace="{mode: 'python', theme: 'monokai'}" ng-model="code" style="height:200px; margin-top: 10px"></div>
      <ul class="list-unstyled">
        <li ng-repeat="log in logs track by $index" ng-class="{ 'text-success': log.type == 'result', 'text-danger': log.type == 'stderr', 'text-warning': log.type == 'system' }">
          <pre class="repl-log"><span ng-show="log.type == 'result'">=> </span>{{ log.message }}</pre>
        </li>
      </ul>
    </div>

    <hr>

    <div class="well" ng-repeat="task in problem.tasks_attributes">
      <div>
        {{ task.input }}
      </div>

      <div class="form-group">
        <label>Answer</label>
        <textarea class="form-control" ng-model="task.submission.input"></textarea>
      </div>

      <p class="help-block">
        You have X submissions left.
      </p>

      <input type="submit" class="btn btn-default">
    </div>
  <% else %>
    <p>Please sign in to solve this task.</p>
  <% end %>
</div>
